//this is the bash script steps for the SM@RT db backup on the central node:

1) Create .pgpass file in home directory of user that will be running the backup
   contents of file: hostname:port:database:username:password
   permission on file: 0600 (disallow access to world or group)

2) Script: (db_bkup.sh)
   #!/bin/bash
   
    LOG_FILE=/db/db_bkup.log
    TIMESTAMP=$(date +"%Y%m%d_%H%M%S")

    pg_dump -Upostgres --column-inserts --exclude-table=edu_logs --exclude-table='sym_*' --exclude-table='fsym_*' edu_new -f /db/edubkup_$TIMESTAMP.sql >> $LOG_FILE
    
    #gunzip the generate file to save space
    gzip edubkup_$TIMESTAMP.sql

    #Clean up after 7 days
    find /db/*.sql -mtime +14 -type f -delete > $LOG_FILE

    php -f /var/www/smart/html/mailConfirm.php

3) Set up crontab everyday at 2:30am

0 3 *  * * /usr/sbin/db_bkup.sh > /dev/null


   

